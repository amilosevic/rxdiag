<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>

    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/2.5.2/rx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/2.5.2/rx.time.js"></script>
</head>
<body>
<h1>Example</h1>

<script>

    var width = 1280;
    var height = 620;

    var sw = 6;
    var r = 1;

    var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

    var defs = svg.append("defs");

    // shadow filter definition

    var filter = defs.append("filter")
            .attr("id", "shadow")
            .attr("height", "185%")
            .attr("width", "165%");

    filter.append("feOffset")
            .attr("in", "SourceAlpha")
            .attr("dx", -7)
            .attr("dy", 7)
            .attr("result", "offset");

    filter.append("feGaussianBlur")
            .attr("in", "offset")
            .attr("stdDeviation", 3)
            .attr("result", "blur");

    filter.append("feBlend")
            .attr("in", "SourceGraphic")
            .attr("in2", "blur")
            .attr("mode", "normal");

    // elements

    function marble(x, y, color) {
        var r = 45;
        return svg.append("circle")
                .attr("cx", x).attr("cy", y)
                .attr("r", r)
                .style("fill", color)
                .style("stroke-width", sw)
                .style("stroke", "black")
                //.style("filter", "url(#shadow)")
                ;
    }

    function square(x, y, color) {
        var d = 90;
        return svg.append("rect")
                .attr("x", x - d/2).attr("y", y - d/2)
                .attr("height", d).attr("width", d)
                .attr("rx", r).attr("ry", r)
                .style("fill", color)
                .style("stroke-width", sw)
                .style("stroke", "black")
                //.style("filter", "url(#shadow)")
                ;
    }

    function diamond(x, y, color) {
        var d = 60;
        return svg.append("rect")
                .attr("x", x - d/2).attr("y", y - d/2)
                .attr("height", d).attr("width", d)
                .attr("rx", r).attr("ry", r)
                .attr("transform", "rotate(45, " + (x) + ", " + (y) +")")
                .style("fill", color)
                .style("stroke-width", sw)
                .style("stroke", "black")
                //.style("filter", "url(#shadow)")
                ;
    }

    function pentagon(x, y, color) {
        var dm = 90, r = dm/2;

        var a = Math.round(r * 0.8);
        var b = Math.round(r * 0.59);
        var c = Math.round(r * 0.2);
        var d = Math.round(r * 0.98);

        var points =
                x       + "," + (y - r) + ", " +
                (x - d) + "," + (y - c) + ", " +
                (x - b) + "," + (y + a) + ", " +
                (x + b) + "," + (y + a) + ", " +
                (x + d) + "," + (y - c);


        return svg.append("polygon")
                .attr("points", points)
                .style("fill", color)
                .style("stroke-linejoin", "round")
                .style("stroke-width", sw)
                .style("stroke", "black");

    }

    function triangle(x, y, color) {
        var dm = 90, r = dm/2;

        var s = r * 2 * 0.86;

        var a = Math.round(s * 0.86 - r);
        var b = Math.round(s * 0.5);

        var points =
                (x + b) + "," + (y - a) + ", " +
                (x)     + "," + (y + r) + ", " +
                (x - b) + "," + (y - a);


        return svg.append("polygon")
                .attr("points", points)
                .style("fill", color)
                .style("stroke-linejoin", "round")
                .style("stroke-width", sw)
                .style("stroke", "black");

    }



    function eventline(y) {
        return svg.append("line")
                .attr("x1", 15).attr("x2", width - 15)
                .attr("y1", y).attr("y2", y)
                .style("stroke-width", sw)
                .style("stroke", "black")
                ;
    }

    function combinatorbox(y, text) {
        h = 130;
        w = width - 2*15;
        return svg.append("rect")
                .attr("x", 15).attr("y", y - h/2)
                .attr("height", h).attr("width", w)
                .attr("rx", r).attr("ry", r)
                .style("fill", "white")
                .style("stroke-width", sw)
                .style("stroke", "black")
                ;

    }

    function complete(x, y) {
        var v = 40;
        return svg.append("line")
                .attr("x1", x).attr("x2", x)
                .attr("y1", y - v).attr("y2", y + v)
                .style("stroke-width", sw)
                .style("stroke", "black")
                ;
    }

    function error(x, y) {
        var v = 40;
        var g = svg.append("g");
        g.append("line")
                .attr("x1", x - v).attr("x2", x + v)
                .attr("y1", y - v).attr("y2", y + v);
        g.append("line")
                .attr("x1", x + v).attr("x2", x - v)
                .attr("y1", y - v).attr("y2", y + v);

        return g.style("stroke-width", sw)
                .style("stroke", "black");

    }



    var evline1 = eventline(100);
    var evline2 = eventline(500);
    var cbox = combinatorbox(310, "FlatMap");

    var marble1 = marble(100, 100, "green");
    var square1 = square(400, 100, "steelblue");
    var diamond1 = diamond(800, 100, "red");
    var pent1 = pentagon(600, 100, "brown");
    var tria1 = triangle(250, 100, "pink");
    var complete1 = complete(900, 100);
    var err1 = error(1100, 100);

    // rx sample

    var source = Rx.Observable.range(2,8);

    var subscription = source.subscribe(
            function (x) { console.log('onNext: ' + x); },
            function (e) { console.log('onError: ' + e.message); },
            function () { console.log('onCompleted'); }
    );

    console.log('Current time: ' + Date.now());

    var timer = Rx.Observable.timer(
            5000, /* 5 seconds */
            16 /* 1 second */)
            .timestamp();

    var combined = Rx.Observable.zip(
            source,
            timer,
            function(e1, e2) {
                return [e1, e2];
            }
    );


    var combinator = combined.subscribe(
            function (x) {
                console.log(x[0] + ": " + x[1].timestamp);
                // move
                //diamond1.attr("transform", "translate(" + (90 + 5*[x[0]]) + ",0) rotate(45)");
            }
    );


</script>

</body>
</html>